# å¦‚ä½•ç¢ºèªè³‡æ–™å¯«å…¥ Cloud SQL

## ğŸ” æ–¹æ³• 1ï¼šä½¿ç”¨ GCP Console æŸ¥çœ‹æ—¥èªŒï¼ˆæ¨è–¦ï¼‰

1. **é–‹å•Ÿ Cloud Run æ—¥èªŒ**
   ```
   https://console.cloud.google.com/run/detail/asia-east1/student-analytics-backend/logs
   ```

2. **æœå°‹é—œéµå­—**
   - æœå°‹ "ä½¿ç”¨ Cloud SQL" - ç¢ºèªé€£æ¥æˆåŠŸ
   - æœå°‹ "rows_inserted" - æŸ¥çœ‹æ’å…¥çš„è¨˜éŒ„æ•¸
   - æœå°‹ "table_name" - æŸ¥çœ‹å»ºç«‹çš„è³‡æ–™è¡¨åç¨±

---

## ğŸ“Š æ–¹æ³• 2ï¼šä½¿ç”¨ gcloud æŸ¥è©¢è³‡æ–™åº«

### åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨
```powershell
gcloud sql databases list --instance=student-analytics-db
```

### åŸ·è¡Œ SQL æŸ¥è©¢
```powershell
# æŸ¥è©¢è³‡æ–™è¡¨æ•¸é‡
gcloud sql operations list --instance=student-analytics-db --limit=10
```

---

## ğŸŒ æ–¹æ³• 3ï¼šç›´æ¥æ¸¬è©¦ç¶²ç«™åŠŸèƒ½ï¼ˆæœ€ç›´è§€ï¼‰

1. **è¨ªå•ç¶²ç«™**
   ```
   https://student-analytics-prod.web.app
   ```

2. **ç™»å…¥ä¸¦ä¸Šå‚³æª”æ¡ˆ**
   - ä½¿ç”¨ä½ çš„å¸³è™Ÿç™»å…¥
   - ä¸Šå‚³ä¸€å€‹ Excel æª”æ¡ˆ
   - é¸æ“‡å·¥ä½œè¡¨

3. **æª¢æŸ¥çµæœ**
   - âœ… å¦‚æœä¸Šå‚³æˆåŠŸä¸¦é¡¯ç¤ºã€ŒæˆåŠŸå­˜å…¥è³‡æ–™åº«ã€â†’ å·²å¯«å…¥ Cloud SQL
   - âœ… åœ¨ã€Œè³‡æ–™ç®¡ç†ã€é é¢çœ‹åˆ°è³‡æ–™è¡¨ â†’ è³‡æ–™åœ¨è³‡æ–™åº«ä¸­
   - âœ… åŸ·è¡Œåˆ†æåŠŸèƒ½æ­£å¸¸é‹ä½œ â†’ å¯ä»¥è®€å–è³‡æ–™

---

## ğŸ”§ æ–¹æ³• 4ï¼šä½¿ç”¨ Cloud SQL Studioï¼ˆGUI å·¥å…·ï¼‰

1. **é–‹å•Ÿ Cloud SQL Console**
   ```
   https://console.cloud.google.com/sql/instances/student-analytics-db/overview?project=student-analytics-prod
   ```

2. **é»æ“Šã€ŒCloud SQL Studioã€åˆ†é **

3. **åŸ·è¡ŒæŸ¥è©¢**
   ```sql
   -- åˆ—å‡ºæ‰€æœ‰è³‡æ–™è¡¨
   SELECT table_name 
   FROM information_schema.tables 
   WHERE table_schema = 'public';
   
   -- æŸ¥çœ‹ users è³‡æ–™è¡¨
   SELECT * FROM users;
   
   -- æŸ¥çœ‹ä¸Šå‚³è¨˜éŒ„
   SELECT * FROM uploaded_files ORDER BY upload_time DESC;
   ```

---

## âœ… é æœŸçµæœ

å¦‚æœè³‡æ–™æˆåŠŸå¯«å…¥ Cloud SQLï¼Œä½ æ‡‰è©²çœ‹åˆ°ï¼š

1. **Cloud Run æ—¥èªŒä¸­æœ‰**ï¼š
   ```
   [INFO] ä½¿ç”¨ Cloud SQL: student-analytics-prod:asia-east1:student-analytics-db
   ```

2. **ä¸Šå‚³æª”æ¡ˆå¾Œçœ‹åˆ°**ï¼š
   ```json
   {
     "success": true,
     "table_name": "1_æ•´ç†å¾Œç¸½è¡¨_251208123456",
     "rows_inserted": 1234
   }
   ```

3. **è³‡æ–™è¡¨å‘½åæ ¼å¼**ï¼š`{user_id}_{å·¥ä½œè¡¨åç¨±}_{æ™‚é–“æˆ³}`
   - ä¾‹å¦‚ï¼š`1_æ•´ç†å¾Œç¸½è¡¨_251208123456`
   - è¡¨ç¤º user_id=1 çš„ç”¨æˆ¶ä¸Šå‚³çš„è³‡æ–™

4. **åœ¨è³‡æ–™ç®¡ç†é é¢**ï¼š
   - å¯ä»¥çœ‹åˆ°å·²ä¸Šå‚³çš„è³‡æ–™è¡¨åˆ—è¡¨
   - å¯ä»¥æŸ¥çœ‹ã€ç·¨è¼¯ã€åˆªé™¤è³‡æ–™

---

## âš ï¸ å¦‚æœæ²’æœ‰å¯«å…¥æˆåŠŸ

æª¢æŸ¥ä»¥ä¸‹äº‹é …ï¼š

1. **Cloud Run ç’°å¢ƒè®Šæ•¸æ˜¯å¦è¨­å®šæ­£ç¢º**
   ```powershell
   gcloud run services describe student-analytics-backend --region asia-east1 --format="yaml(spec.template.spec.containers[0].env)"
   ```
   
   æ‡‰è©²çœ‹åˆ°ï¼š
   - `USE_CLOUD_SQL=true`
   - `CLOUD_SQL_CONNECTION_NAME=student-analytics-prod:asia-east1:student-analytics-db`
   - `DB_USER=postgres`
   - å…¶ä»–è³‡æ–™åº«ç›¸é—œè®Šæ•¸

2. **Cloud SQL å¯¦ä¾‹æ˜¯å¦å•Ÿå‹•**
   ```powershell
   gcloud sql instances describe student-analytics-db --format="value(state)"
   ```
   
   æ‡‰è©²é¡¯ç¤ºï¼š`RUNNABLE`

3. **Cloud Run æ˜¯å¦é€£æ¥ Cloud SQL**
   ```powershell
   gcloud run services describe student-analytics-backend --region asia-east1 --format="yaml(spec.template.metadata.annotations)"
   ```
   
   æ‡‰è©²çœ‹åˆ°ï¼š`run.googleapis.com/cloudsql-instances`

---

## ğŸ’¡ å¿«é€Ÿæ¸¬è©¦å‘½ä»¤

ä¸€éµåŸ·è¡Œæ‰€æœ‰æª¢æŸ¥ï¼š

```powershell
# æª¢æŸ¥ Cloud SQL ç‹€æ…‹
Write-Host "`n=== Cloud SQL å¯¦ä¾‹ç‹€æ…‹ ===" -ForegroundColor Cyan
gcloud sql instances describe student-analytics-db --format="value(state)"

# æª¢æŸ¥ Cloud Run ç’°å¢ƒè®Šæ•¸
Write-Host "`n=== Cloud Run ç’°å¢ƒè®Šæ•¸ ===" -ForegroundColor Cyan
gcloud run services describe student-analytics-backend --region asia-east1 --format="yaml(spec.template.spec.containers[0].env)"

# æª¢æŸ¥æœ€æ–°æ—¥èªŒ
Write-Host "`n=== æœ€æ–°æ—¥èªŒ ===" -ForegroundColor Cyan
gcloud run services logs read student-analytics-backend --region asia-east1 --limit 10
```
